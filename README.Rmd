---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
    collapse = TRUE,
    comment = "#>",
    fig.path = "man/figures/README-",
    fig.retina = 2,
    dpi = 300,
    out.width = "80%",
    out.height = "80%"
)
```

# simulariatools <a href="https://www.simularia.it/simulariatools/"><img src="man/figures/logo.png" align="right" height="138" /></a>

<!-- badges: start -->
[![R-CMD-check](https://github.com/Simularia/simulariatools/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/Simularia/simulariatools/actions/workflows/R-CMD-check.yaml)
[![CRAN status](https://www.r-pkg.org/badges/version/simulariatools)](https://CRAN.R-project.org/package=simulariatools)
[![CRAN downloads](https://cranlogs.r-pkg.org/badges/grand-total/simulariatools?color=brightgreen)](https://CRAN.R-project.org/package=simulariatools)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.165117.svg)](https://doi.org/10.5281/zenodo.596741)
<!-- badges: end -->


## Overview

**simulariatools** is an open-source R package developed by [Simularia](https://www.simularia.it/), an environmental consulting firm specialized in atmospheric dispersion modelling.

It provides a collection of functions to pre- and post-process meteorological and air quality data in the context of air quality and odour dispersion modelling.

It is used daily in real-world applications, improving reproducibility, saving time and reducing errors.

### Key functions

- `contourPlot2()` plots a production-ready contour map of a pollutant concentration field.
- `plotAvgRad()` plots the hourly average of solar radiation.
- `plotAvgTemp()` plots the average atmospheric temperature.
- `plotStabilityClass()` plots histograms of atmospheric stability class.
- `vectorField()` plots a simple vector field given two components.
- `importRaster()` imports a generic raster file.
- `importADSOBIN()` imports an ADSO/BIN raster file.
- `importSurferGrd()` imports a grid file (CALPUFF).
- `stabilityClass()` computes atmospheric stability class.
- `turnerStabilityClass()` computes atmospheric PGT stability class with Turner method.
- `downloadBasemap()` downloads GeoTIFF basemaps from the Italian [PCN](https://gn.mase.gov.it/portale/home).
- `removeOutliers()` removes time series outliers based on interquartile range.
- `rollingMax()` computes rolling max of a time series.


## Installation

To install the latest release of **simulariatools** from CRAN:
```{r eval=FALSE, include=TRUE}
install.packages("simulariatools")
```

> NOTE:
> To import *ADSO/BIN* data files via `importADSOBIN()`, a working installation
> of *Python3* is required. For more information about *R* and *Python*
> interoperability, please refer to the documentation of
> [`reticulate`](https://rstudio.github.io/reticulate/).


### Development version

To get bug fixes or to use a feature from the development version, install the
development version from GitHub:
```{r eval=FALSE, include=TRUE}
# install.packages("pak")
pak::pkg_install("Simularia/simulariatools")
```

## Examples

### Contour Plot from NetCDF

First, import air quality data from *NetCDF* file with the appropriate convenience function:
```{r echo=TRUE}
library(simulariatools)
nox_concentration <- importRaster(
    file = "./development/conc_avg.nc",
    k = 1000,
    destaggering = TRUE,
    variable = "nox",
    verbose = TRUE
)
```
Concentration data are imported as a `data.frame` with `x` and `y` columns corresponding to
the coordinates of the cell centre and a `z` column for grid values.
```{r echo=TRUE}
str(nox_concentration)
```

A quick contour plot, with default configuration, can be easily obtained by
running `contourPlot2()` without any optional argument:
```{r}
contourPlot2(nox_concentration)
```

The plot is customisable by using `contourPlot2()` arguments and by piping
**ggplot2** instructions together with the `+` operator.

In the following example, the original domain is cropped, colour levels are
explicitly assigned and a legend name is provided through function arguments.
Furthermore, `labs()` and `theme_minimal()` functions from **ggplot2** are used
to remove axis labels and to change the overall theme:
```{r echo=TRUE}
library(ggplot2)
contourPlot2(
    nox_concentration,
    xlim = c(502000, 519000),
    ylim = c(4943125, 4955125),
    nticks = 5,
    levels = c(-Inf, 0.5, 1, 1.5, 2, Inf),
    legend = "NOx [ug/m3]"
) +
    labs(x = NULL, y = NULL) +
    theme_minimal()
```

In order to save the last plot to file, you can directly use the **ggplot2**
function `ggsave()`:
```{r eval=FALSE}
ggsave(filename = "~/path/to/myplot.png", width = 7, height = 6, dpi = 300)
```

Optional arguments can be used to create special versions of the plot.
For example, use `tile = TRUE` to produce a plot without spatial interpolation:
```{r echo=TRUE}
contourPlot2(
    nox_concentration,
    tile = TRUE,
    legend = "NOx [ug/m3]"
)
```


## Citation

If you use `simulariatools` in your work, please consider citing it:

> Giuseppe Carlino. (2026). Simularia/simulariatools: simulariatools 3.1.0 (v3.1.0). Zenodo. [https://doi.org/10.5281/zenodo.18184316](https://doi.org/10.5281/zenodo.18184316).


## Contact

Maintained by [Giuseppe Carlino](https://github.com/gcarlino) (Simularia srl).


## Contributors

[Matteo Paolo Costa](https://github.com/teocos)
